<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Seeing Machines CoreData API: Defining a Custom OutputData Class</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.0 -->
<h1><a class="anchor" name="coreapi_coredata_clientdefined_classes">Defining a Custom OutputData Class</a></h1><dl class="user" compact><dt><b></b></dt><dd><a class="el" href="coreapi_coredata_clientdefined_classes.html#coreapi_coredata_clientdefined_classes_intro">1. Introduction</a><br>
 <a class="el" href="coreapi_coredata_clientdefined_classes.html#coreapi_coredata_clientdefined_classes_class">2. Defining Your Custom Class</a><br>
 <a class="el" href="coreapi_coredata_clientdefined_classes.html#coreapi_coredata_clientdefined_classes_usage">3. Using Your Custom Class</a><br>
</dd></dl>
<hr>
 <h2><a class="anchor" name="coreapi_coredata_clientdefined_classes_intro">
1. Introduction</a></h2>
The CoreData C++ API lets you define your own custom output data class, and then use it just like any other CoreData output data class.<p>
<hr>
 <h2><a class="anchor" name="coreapi_coredata_clientdefined_classes_class">
2. Defining Your Custom Class</a></h2>
There are 4 main steps in defining your custom output data class, so that it is compatible with CoreData:<p>
<ol type=1>
<li>Derive publicly from <a class="el" href="classsm_1_1eod_1_1_engine_output_base.html">sm::eod::EngineOutputBase</a></li><li>Define a unique identifier</li><li>Override/implement all necessary virtual member functions</li><li>Implement a virtual constructor</li></ol>
<h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_class_eob">
2.1 Derive Publicly from EngineOutputBase</a></h3>
All CoreData compatible output data classes must derive publicly from <a class="el" href="classsm_1_1eod_1_1_engine_output_base.html">sm::eod::EngineOutputBase</a>. E.g.:<p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>EarlobeOutputData : <span class="keyword">public</span> sm::eod::EngineOutputBase
{
    ...
};
</pre></div><h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_class_id">
2.2 Define a Unique Identifier</a></h3>
All CoreData compatible output data classes must define a unique identifier:<p>
<ul>
<li>The identifier must be an integer between -128 and 127 that is not already used by CoreData output data classes, or by other custom defined output data classes.</li><li>Your class should publicly declare its identifier using the macro <a class="el" href="group__general__macros.html#g7bacb88e44b29c926b5f55530e072be8">COREDATA_DECLARE_THIS_OBJECT_ID</a></li></ul>
<p>
For example:<p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>EarlobeOutputData : <span class="keyword">public</span> sm::eod::EngineOutputBase
{
<span class="keyword">public</span>:
        <span class="comment">//The ID that identifies an object of this type</span>
        <a class="code" href="group__general__macros.html#g7bacb88e44b29c926b5f55530e072be8">COREDATA_DECLARE_THIS_OBJECT_ID</a>(-90);
    
    ...
};
</pre></div><h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_class_virtualmethods">
2.3 Implement Virtual Methods</a></h3>
<a class="el" href="classsm_1_1eod_1_1_engine_output_base.html">EngineOutputBase</a> (together with <a class="el" href="classsm_1_1eod_1_1_serializable_composite.html">SerializableComposite</a> and <a class="el" href="classsm_1_1eod_1_1_serializable.html">Serializable</a>) declares a set of virtual methods which must be implemented by your custom output data class.<p>
The methods which must be implemented are:<p>
<ul>
<li>public:<ul>
<li><a class="el" href="classsm_1_1eod_1_1_serializable.html#57ac6eac6c8a468b7f12f75cf1d86680">clone()</a></li><li><a class="el" href="classsm_1_1eod_1_1_serializable.html#982f236aab8531dbfb26e651ebac1380">objectID()</a></li></ul>
</li><li>private:<ul>
<li><a class="el" href="classsm_1_1eod_1_1_engine_output_base.html#a3ad48e98e7f2fa6cf717641935f6245">appendEngineSpecificData()</a></li><li><a class="el" href="classsm_1_1eod_1_1_engine_output_base.html#cead64eb991872e820970293073a4afd">readEngineSpecificData()</a></li><li><a class="el" href="classsm_1_1eod_1_1_engine_output_base.html#f87e4b42bb6cdf7516f50711157fcd26">numEngineSpecificDataBytes()</a></li><li><a class="el" href="classsm_1_1eod_1_1_serializable_composite.html#42ada790b2b8514839e018320bba0e86">printOwnHeader()</a></li><li><a class="el" href="classsm_1_1eod_1_1_serializable_composite.html#cce4896c67eb64420ae4d7db4c78c907">printOwnData()</a></li></ul>
</li></ul>
<h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_class_virtualconstructor">
2.4 Declare a Virtual Constructor</a></h3>
All custom output data classes should define a "virtual constructor": a function which instantiates a custom output data object on the heap, and then returns a shared pointer to it.<p>
It is common practice to include a class's virtual constructor as a public static member function called "create".<p>
For example: <div class="fragment"><pre class="fragment"><span class="keyword">class </span>EarlobeOutputData : <span class="keyword">public</span> sm::eod::EngineOutputBase
{
<span class="keyword">public</span>:
    ...
    
    <span class="comment">// Return a shared pointer to an object of this type, created on the heap.</span>
    <span class="keyword">static</span> <a class="code" href="namespacesm_1_1eod.html#6f36de200c458ac513ef3683b5e3538d">sm::eod::SerializablePtr</a> create()
    {
        <span class="keywordflow">return</span> <a class="code" href="namespacesm_1_1eod.html#6f36de200c458ac513ef3683b5e3538d">sm::eod::SerializablePtr</a>(<span class="keyword">new</span> EarlobeOutputData);
    }
    
    ...
};
</pre></div><h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_class_eg">
2.4 Example</a></h3>
Below is the declaration of an example custom output data class, illustrating the required steps described above.<p>
Note:<ul>
<li><a class="el" href="group__macros__memory__management.html#g732acef94867fdc0a27ba04da561eede">COREDATA_MEMORY_ALLOCATORS</a> is used to support memory pooling. See <a class="el" href="coreapi_coredata_cpp_main.html#coreapi_coredata_cpp_main_usage_memory_pooling">Memory Pooling</a> for details.</li><li>A true <code>EarlobeOutputData</code> class would require other member functions, e.g <code>getEarlobePosition()</code>, <code>setEarlobePosition()</code>.</li></ul>
<p>
(See <a class="el" href="coreapi_coredata_clientdefined_classes_sampleimpl.html">here</a> for an example implementation of this class.)<p>
<div class="fragment"><pre class="fragment"><span class="comment">// Example custom output data class, encapsulating the 3D position of an earlobe.</span>
<span class="keyword">class </span>EarlobeOutputData : <span class="keyword">public</span> sm::eod::EngineOutputBase
{
    <span class="comment">// Support memory pooling</span>
    <a class="code" href="group__macros__memory__management.html#g732acef94867fdc0a27ba04da561eede">COREDATA_MEMORY_ALLOCATORS</a>(EarlobeOutputData)

public:
    <span class="comment">// Declare unique identifier</span>
    <a class="code" href="group__general__macros.html#g7bacb88e44b29c926b5f55530e072be8">COREDATA_DECLARE_THIS_OBJECT_ID</a>(-90);
    
    <span class="comment">// Virtual constructor</span>
    <span class="comment">/* Return a shared pointer to an object of this type, created on the heap */</span>
    static sm::eod::<a class="code" href="namespacesm_1_1eod.html#6f36de200c458ac513ef3683b5e3538d">SerializablePtr</a> create();        
    <span class="comment">// Default constructor</span>
    EarlobeOutputData();
    <span class="comment">// Copy constructor</span>
    EarlobeOutputData(const EarlobeOutputData&amp; rhs);   
    <span class="comment">// Destructor</span>
    virtual ~EarlobeOutputData();
    <span class="comment">// Assignment operator</span>
    EarlobeOutputData&amp; operator=(const EarlobeOutputData&amp; rhs);           
    <span class="comment">// Return a copy of this object, allocated on the heap</span>
    virtual EarlobeOutputData* clone() const;  
    <span class="comment">// Return the unique object ID</span>
    virtual ObjectID objectID() const;   
      
private:
    <span class="comment">// See EngineOutputBase</span>
    virtual <span class="keywordtype">void</span> appendEngineSpecificData(std::vector&lt;uint8&gt;&amp; buffer) const;       
    <span class="comment">// See EngineOutputBase</span>
    virtual <span class="keywordtype">void</span> readEngineSpecificData(const std::vector&lt;uint8&gt;&amp; buffer, <span class="keywordtype">int</span>&amp; read_pos);   
    <span class="comment">// See EngineOutputBase</span>
    virtual uint32 numEngineSpecificDataBytes() const;        
    <span class="comment">// See SerializableComposite</span>
    virtual <span class="keywordtype">void</span> printOwnData(std::ostream&amp; s) const;                   
    <span class="comment">// See SerializableComposite</span>
    virtual <span class="keywordtype">void</span> printOwnHeader(std::ostream&amp; s) const;                                                   
    <span class="comment">// Utility function</span>
    <span class="keywordtype">void</span> copyFrom(const EarlobeOutputData&amp; rhs);    
            
    <span class="comment">// The raw data</span>
    std::vector&lt;<span class="keywordtype">double</span>&gt; _earlobe_position;          
};
</pre></div><p>
<hr>
 <h2><a class="anchor" name="coreapi_coredata_clientdefined_classes_usage">
3. Using Your Custom Class</a></h2>
This sections describes how to use a custom output data class with CoreData.<h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_usage_register">
3.1 Registering with SerializableFactory</a></h3>
All custom output data classes must be registered with <a class="el" href="classsm_1_1eod_1_1_serializable_factory.html#87534ca8717e1b24e2f17534a575d7d2">SerializableFactory::registerObjectType</a>. The arguments to this function are:<ul>
<li>the custom class unique identifier</li><li>pointer to a create function (e.g. class virtual constructor)</li></ul>
<p>
(Note there is no need to register the predefined set of CoreData output data classes, they are already internally registered.)<p>
For example:<p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;<a class="code" href="sdk_8h.html">eod/sdk.h</a>&gt;</span>
<span class="preprocessor">#include "earlobeoutputdata.h"</span>

<span class="keyword">using namespace </span>sm::eod;

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
{
    SerializableFactory::registerObjectType(EarlobeOutputData::THIS_OBJECT_ID,EarlobeOutputData::create);
    
    ...
}
</pre></div><h3><a class="anchor" name="coreapi_coredata_clientdefined_classes_usage_register">
3.1 Registering with SerializableFactory</a></h3>
Once a custom output data class has been defined and registered as described above, it can be used just like any of the predefined CoreData output data classes. The following example illustrates a simple use of the EarlobeOutputData class defined above.<p>
<div class="fragment"><pre class="fragment">    ...
    
    <span class="comment">// Add an EarlobeOutputData to an EngineOutputData object</span>
    EngineOutputData eod;        
    eod.addSubObject&lt;EarlobeOutputData&gt;();

    <span class="comment">// Retrieve the earlobe data</span>
    <a class="code" href="namespacesm_1_1eod.html#6f36de200c458ac513ef3683b5e3538d">SerializablePtr</a> s = eod.subObject(EarlobeOutputData::THIS_OBJECT_ID);
    assert(s);      
           
    <span class="comment">// Serialize the eod</span>
    std::vector&lt;uint8&gt; buffer;
    eod.serialize(buffer);
    CPPUNIT_ASSERT_EQUAL(static_cast&lt;size_t&gt;(eod.numTotalBytes()), buffer.size());

    <span class="comment">// Unserialize</span>
    EngineOutputData eod_out;   
    <span class="keywordtype">int</span> read_pos = 0;
    eod_out.unSerialize(buffer, read_pos);

    <span class="comment">// Retrieve the earlobe data from the unserialized eod</span>
    <a class="code" href="namespacesm_1_1eod.html#6f36de200c458ac513ef3683b5e3538d">SerializablePtr</a> s_out = eod_out.subObject(EarlobeOutputData::THIS_OBJECT_ID);
    assert(s_out);
    
    <span class="comment">// Remove the EarlobeOutputData subobject</span>
    eod_out.removeSubObject(EarlobeOutputData::THIS_OBJECT_ID);
    s_out = eod_out.subObject(EarlobeOutputData::THIS_OBJECT_ID);
    assert(!s_out);
    
    ...
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Fri Apr 1 15:36:50 2011 for Seeing Machines CoreData API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.0 </small></address>
</body>
</html>
